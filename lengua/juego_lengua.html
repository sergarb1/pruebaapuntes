<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Sintaxis Mastery: Balanced Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        :root { --bg: #020617; }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); overflow: hidden; font-family: 'Outfit', sans-serif; display: flex; justify-content: center; align-items: center; height: 100dvh; width: 100vw; }
        #game-container { width: 100%; height: 100%; }
    </style>
</head>
<body>
    <div id="game-container"></div>
    <script>
        // --- ðŸ“Š BANCO DE DATOS MAESTRO (150 EJERCICIOS) ---
        // (Se mantienen los 150 retos generados anteriormente)
        const MASTER_DATABASE = [
            { s: "Me gustan mucho los libros de aventuras.", q: "Â¿CuÃ¡l es el SUJETO?", ops: ["Yo", "Me", "Los libros de aventuras"], ok: 2, ana: "Concuerda con 'gustan'.", adv: "TIP: Cambia a 'Gusta' -> 'El libro'." },
            { s: "ConfÃ­o plenamente en tus posibilidades.", q: "Â¿FunciÃ³n de 'EN TUS POSIBILIDADES'?", ops: ["C. RÃ©gimen", "CI", "CC Modo"], ok: 0, ana: "Confiar rige 'en'.", adv: "TIP: Prep obligatoria = C. RÃ©gimen." },
            { s: "La noticia fue difundida por los medios.", q: "FunciÃ³n de 'POR LOS MEDIOS'.", ops: ["CCL", "C. Agente", "CI"], ok: 1, ana: "Ejecutor en voz pasiva.", adv: "TIP: Empieza por POR en pasivas." },
            { s: "Ayer me encontrÃ© a tu hermano.", q: "FunciÃ³n de 'A TU HERMANO'.", ops: ["CI", "CD", "Sujeto"], ok: 1, ana: "CD de persona determinada.", adv: "TIP: 'LO encontrÃ©' = CD." },
            { s: "Juan le dio un regalo a su amiga.", q: "FunciÃ³n de 'A SU AMIGA'.", ops: ["CD", "CI", "Atr"], ok: 1, ana: "Destinatario.", adv: "TIP: 'LE dio' = CI." },
            { s: "HabÃ­a muchas personas allÃ­.", q: "Identifica el SUJETO.", ops: ["Muchas personas", "Ellos", "No tiene"], ok: 2, ana: "Impersonal con HABER.", adv: "TIP: Nunca digas 'HabÃ­an'." },
            { s: "Los niÃ±os corren alegres.", q: "FunciÃ³n de 'ALEGRES'.", ops: ["CC Modo", "C. Predicativo", "Atr"], ok: 1, ana: "Adjetivo concordado.", adv: "TIP: Pluraliza -> 'Alegre'." },
            { s: "Luis es pianista.", q: "Analiza 'PIANISTA'.", ops: ["CD", "Atributo", "CPred"], ok: 1, ana: "Tras verbo copulativo.", adv: "TIP: 'Luis LO es'." },
            { s: "CortÃ³ el pan con un cuchillo.", q: "FunciÃ³n de 'CON UN CUCHILLO'.", ops: ["CC Modo", "CC Instrumento", "CRÃ©g"], ok: 1, ana: "Herramienta usada.", adv: "TIP: Responde a Â¿Con quÃ©?" },
            { s: "Se arrepintiÃ³ de su error.", q: "FunciÃ³n de 'DE SU ERROR'.", ops: ["CD", "C. RÃ©gimen", "CI"], ok: 1, ana: "Prep exigida por el verbo.", adv: "TIP: Arrepentirse DE." },
            { s: "Le entregÃ³ las llaves.", q: "FunciÃ³n de 'LE'.", ops: ["CD", "CI", "Suj"], ok: 1, ana: "Pronombre de CI.", adv: "TIP: LE siempre es CI." },
            { s: "Nombraron delegada a Ana.", q: "FunciÃ³n de 'DELEGADA'.", ops: ["Atr", "C. Predicativo", "CN"], ok: 1, ana: "CPred del CD (Ana).", adv: "TIP: Concuerda con Ana." },
            { s: "La casa es de piedra.", q: "FunciÃ³n de 'DE PIEDRA'.", ops: ["Atributo", "CC Modo", "CRÃ©g"], ok: 0, ana: "Atributo preposicional.", adv: "TIP: 'La casa LO es'." },
            { s: "Corre muy rÃ¡pido.", q: "FunciÃ³n de 'RÃPIDO'.", ops: ["CPred", "CC Modo", "Atr"], ok: 1, ana: "Adverbio invariable.", adv: "TIP: No concuerda con Suj." },
            { s: "Luis se parece a su tÃ­a.", q: "FunciÃ³n de 'A SU TÃA'.", ops: ["CI", "Atributo", "CRÃ©g"], ok: 1, ana: "Atributo con parecer.", adv: "TIP: 'Luis lo parece'." },
            { s: "Nieva en la montaÃ±a.", q: "Sujeto.", ops: ["Nieva", "MontaÃ±a", "No tiene"], ok: 2, ana: "Impersonal climÃ¡tica.", adv: "TIP: Verbos meteorolÃ³gicos." },
            { s: "Se oye un grito.", q: "Sujeto.", ops: ["Un grito", "Ã‰l", "No tiene"], ok: 0, ana: "Pasiva Refleja.", adv: "TIP: 'Se oyen gritos'." },
            { s: "Fue robado ayer.", q: "Sujeto.", ops: ["Ayer", "Ã‰l (elidido)", "No tiene"], ok: 1, ana: "Sujeto paciente.", adv: "TIP: Concuerda con fue." },
            { s: "Me pica la espalda.", q: "Sujeto.", ops: ["Me", "La espalda", "Yo"], ok: 1, ana: "La cabeza (Sujeto) concuerda con Duele.", adv: "TIP: Â¡Cuidado! 'Me' es CI. 'Me duelen las piernas' (Plural)." },
            { s: "HacÃ­a frÃ­o.", q: "FunciÃ³n de 'FRÃO'.", ops: ["Sujeto", "CD", "CCM"], ok: 1, ana: "CD: 'LO hacÃ­a'.", adv: "TIP: HACER clima = Impersonal." },
            { s: "Lo hizo con mimo.", q: "FunciÃ³n de 'CON MIMO'.", ops: ["CCM", "CCI", "CRÃ©g"], ok: 0, ana: "CC de Modo.", adv: "TIP: Â¿CÃ³mo lo hizo?" },
            { s: "Aspira al cargo.", q: "FunciÃ³n de 'AL CARGO'.", ops: ["CI", "C. RÃ©gimen", "CCF"], ok: 1, ana: "Aspirar A algo.", adv: "TIP: Prep obligatoria." },
            { s: "LlovÃ­a mucho.", q: "FunciÃ³n de 'MUCHO'.", ops: ["CCC", "CD", "Suj"], ok: 0, ana: "CC de Cantidad.", adv: "TIP: Indica intensidad." },
            { s: "Habla de cine.", q: "FunciÃ³n de 'DE CINE'.", ops: ["Atr", "CD", "C. RÃ©gimen"], ok: 2, ana: "Hablar DE algo.", adv: "TIP: RÃ©gimen preposicional." },
            { s: "Vino tarde.", q: "FunciÃ³n de 'TARDE'.", ops: ["CCL", "CCT", "CCM"], ok: 1, ana: "CC de Tiempo.", adv: "TIP: Â¿CuÃ¡ndo?" },
            { s: "ComprÃ³ peras.", q: "FunciÃ³n de 'PERAS'.", ops: ["Suj", "CD", "CI"], ok: 1, ana: "CD: 'LAS comprÃ³'.", adv: "TIP: Objeto directo." },
            { s: "Di el pan a Ã©l.", q: "FunciÃ³n de 'A Ã‰L'.", ops: ["CD", "CI", "CCP"], ok: 1, ana: "CI: 'LE di'." , adv: "TIP: Destinatario." },
            { s: "Curado por Luis.", q: "FunciÃ³n de 'POR LUIS'.", ops: ["CCC", "C. Agente", "Suj"], ok: 1, ana: "Agente en pasiva.", adv: "TIP: PreposiciÃ³n POR." },
            { s: "Es para ti.", q: "FunciÃ³n de 'PARA TI'.", ops: ["Atributo", "CI", "CCD"], ok: 0, ana: "Atributo: 'LO es'.", adv: "TIP: Tras verbo SER." },
            { s: "Trae el coche.", q: "Analiza 'EL COCHE'.", ops: ["Suj", "CD", "CCL"], ok: 1, ana: "CD: 'LO trae'.", adv: "TIP: Pasa a pasiva." },
            { s: "Se venden pisos.", q: "Valor del SE.", ops: ["PR", "Imp", "Pron"], ok: 0, ana: "Pasiva Refleja.", adv: "TIP: Plural concuerda." },
            { s: "Se vive bien.", q: "Valor del SE.", ops: ["PR", "Imp", "Ref"], ok: 1, ana: "Impersonal.", adv: "TIP: Sin sujeto." },
            { s: "Se lava la cara.", q: "Valor del SE.", ops: ["Ref CD", "Ref CI", "Rec"], ok: 1, ana: "Reflexivo CI.", adv: "TIP: CD es 'la cara'." },
            { s: "Se miran.", q: "Valor del SE.", ops: ["Ref", "Rec", "Dat"], ok: 1, ana: "RecÃ­proco.", adv: "TIP: Mutuamente." },
            { s: "Se arrepintiÃ³.", q: "Valor del SE.", ops: ["Pron", "Ref", "PR"], ok: 0, ana: "Pronominal.", adv: "TIP: Verbo quejarse/arrepentirse." },
            { s: "Se comiÃ³ el pan.", q: "Valor del SE.", ops: ["Pron", "Dativo", "Imp"], ok: 1, ana: "Dativo Ã‰tico.", adv: "TIP: EnfÃ¡tico." },
            { s: "Se lo di.", q: "Valor del SE.", ops: ["Ref", "Falso SE", "Rec"], ok: 1, ana: "Sustituye LE.", adv: "TIP: LE + LO = SE LO." },
            { s: "Se marchÃ³.", q: "Valor del SE.", ops: ["Ref", "Pronominal", "Imp"], ok: 1, ana: "Pronominal.", adv: "TIP: Inicio de acciÃ³n." },
            { s: "Se busca oro.", q: "Valor del SE.", ops: ["PR", "Imp", "Ref"], ok: 0, ana: "Pasiva Refleja.", adv: "TIP: El oro es buscado." },
            { s: "Se habla ruso.", q: "Valor del SE.", ops: ["PR", "Imp", "Dat"], ok: 0, ana: "Pasiva Refleja.", adv: "TIP: Ruso (Sujeto)." },
            { s: "Se duchÃ³ solo.", q: "Valor del SE.", ops: ["Ref CD", "Ref CI", "Pron"], ok: 0, ana: "Reflexivo CD.", adv: "TIP: A sÃ­ mismo." },
            { s: "Se olvidÃ³ de mÃ­.", q: "Valor del SE.", ops: ["Pron", "Dat", "Ref"], ok: 0, ana: "Pronominal.", adv: "TIP: Olvidarse DE." },
            { s: "Se dieron cita.", q: "Valor del SE.", ops: ["Rec", "PR", "Imp"], ok: 1, ana: "Pasiva Refleja.", adv: "TIP: La cita fue dada." },
            { s: "Se saludaron.", q: "Valor del SE.", ops: ["Ref", "Rec", "Dat"], ok: 1, ana: "RecÃ­proco.", adv: "TIP: El uno al otro." },
            { s: "Se bebiÃ³ el agua.", q: "Valor del SE.", ops: ["Ref", "Dativo", "Pron"], ok: 1, ana: "Dativo Ã‰tico.", adv: "TIP: EnfÃ¡tico." },
            { s: "Se queja mucho.", q: "Valor del SE.", ops: ["Pron", "Imp", "Ref"], ok: 0, ana: "Pronominal.", adv: "TIP: Quejarse." },
            { s: "Se alquila.", q: "Valor del SE.", ops: ["PR", "Imp", "Falso"], ok: 0, ana: "Pasiva Refleja.", adv: "TIP: 'Se alquilan'." },
            { s: "Se durmiÃ³.", q: "Valor del SE.", ops: ["Ref", "Pron", "Imp"], ok: 1, ana: "Pronominal.", adv: "TIP: Cambio estado." },
            { s: "Se sabe todo.", q: "Valor del SE.", ops: ["Imp", "PR", "Pron"], ok: 1, ana: "Pasiva Refleja.", adv: "TIP: Todo es sabido." },
            { s: "Se peina.", q: "Valor del SE.", ops: ["Ref CD", "Ref CI", "Rec"], ok: 0, ana: "Reflexivo CD.", adv: "TIP: AcciÃ³n sobre sÃ­." },
            { s: "Se cansÃ³ ayer.", q: "Valor del SE.", ops: ["Pron", "Ref", "Dat"], ok: 0, ana: "Pronominal.", adv: "TIP: Cansarse." },
            { s: "Se avergÃ¼enza.", q: "Valor del SE.", ops: ["Ref", "Pron", "Imp"], ok: 1, ana: "Pronominal.", adv: "TIP: Verbo de emociÃ³n." },
            { s: "Se cree listo.", q: "Valor del SE.", ops: ["Ref CD", "Ref CI", "Rec"], ok: 0, ana: "Reflexivo CD.", adv: "TIP: Cree a sÃ­ mismo." },
            { s: "Se fue de allÃ­.", q: "Valor del SE.", ops: ["Pron", "Dat", "Imp"], ok: 0, ana: "Pronominal.", adv: "TIP: Irse." },
            { s: "Se puso la ropa.", q: "Valor del SE.", ops: ["Ref CD", "Ref CI", "Pron"], ok: 1, ana: "Reflexivo CI.", adv: "TIP: Ropa es CD." },
            { s: "Se odian mucho.", q: "Valor del SE.", ops: ["Ref", "Rec", "Dat"], ok: 1, ana: "RecÃ­proco.", adv: "TIP: Entre ellos." },
            { s: "Se lee la novela.", q: "Valor del SE.", ops: ["Dativo", "Imp", "PR"], ok: 0, ana: "Dativo Ã‰tico.", adv: "TIP: Ã‰nfasis lector." },
            { s: "Se dice que no.", q: "Valor del SE.", ops: ["Imp", "PR", "Ref"], ok: 0, ana: "Impersonal.", adv: "TIP: Sin sujeto." },
            { s: "Se vende pan.", q: "Valor del SE.", ops: ["PR", "Imp", "Falso"], ok: 0, ana: "Pasiva Refleja.", adv: "TIP: 'Se vende pan'." },
            { s: "Se riÃ³ de Ã©l.", q: "Valor del SE.", ops: ["Pron", "Dat", "Ref"], ok: 0, ana: "Pronominal.", adv: "TIP: ReÃ­rse." },
            { s: "Considera malo eso.", q: "FunciÃ³n de 'MALO'.", ops: ["Atr", "CPred", "CCM"], ok: 1, ana: "CPred del CD.", adv: "TIP: Califica a 'eso'." },
            { s: "Dijo que sÃ­.", q: "Tipo subordinada.", ops: ["Sust", "Adj", "Adv"], ok: 0, ana: "Sustantiva.", adv: "TIP: 'Dijo ESO'." },
            { s: "El bus que parÃ³.", q: "Tipo subordinada.", ops: ["Sust", "Adj", "Adv"], ok: 1, ana: "Adjetiva.", adv: "TIP: 'El cual'." },
            { s: "Vino por estar solo.", q: "Tipo adverbial.", ops: ["Causal", "Cons", "Final"], ok: 0, ana: "Causal.", adv: "TIP: Â¿Por quÃ©?" },
            { s: "Vivo donde puedo.", q: "Tipo adverbial.", ops: ["Lugar", "Tiem", "Modo"], ok: 0, ana: "Lugar.", adv: "TIP: 'Vivo ALLÃ'." },
            { s: "Hazlo como quieras.", q: "Tipo adverbial.", ops: ["Modo", "Tiem", "Lug"], ok: 0, ana: "Modo.", adv: "TIP: 'Hazlo ASÃ'." },
            { s: "Al salir, llovÃ­a.", q: "Tipo adverbial.", ops: ["Tiem", "Caus", "Fin"], ok: 0, ana: "Tiempo.", adv: "TIP: 'ENTONCES'." },
            { s: "Listo pero vago.", q: "Tipo coordinada.", ops: ["Adv", "Cop", "Dis"], ok: 0, ana: "Adversativa.", adv: "TIP: Nexo pero." },
            { s: "O entras o sales.", q: "Tipo coordinada.", ops: ["Dis", "Dist", "Cop"], ok: 0, ana: "Disyuntiva.", adv: "TIP: ElecciÃ³n." },
            { s: "O sea, no viene.", q: "Tipo coordinada.", ops: ["Expl", "Cons", "Cop"], ok: 0, ana: "Explicativa.", adv: "TIP: Aclara." },
            { s: "Luego existo.", q: "Tipo coordinada.", ops: ["Cons", "Caus", "Fin"], ok: 0, ana: "Consecutiva.", adv: "TIP: Resultado." },
            { s: "Tan alto que no ve.", q: "Tipo subordinada.", ops: ["Cons", "Caus", "Fin"], ok: 0, ana: "Consecutiva.", adv: "TIP: TAN... QUE." },
            { s: "Mejor que tÃº.", q: "Tipo subordinada.", ops: ["Comp", "Mod", "Cons"], ok: 0, ana: "Comparativa.", adv: "TIP: Superioridad." },
            { s: "Vino para ver.", q: "Tipo subordinada.", ops: ["Final", "Caus", "Cons"], ok: 0, ana: "Final.", adv: "TIP: Â¿Para quÃ©?" },
            { s: "Si llueve, no voy.", q: "Tipo subordinada.", ops: ["Cond", "Conc", "Caus"], ok: 0, ana: "Condicional.", adv: "TIP: Nexo SI." },
            { s: "Aunque llueva, voy.", q: "Tipo subordinada.", ops: ["Conc", "Caus", "Fin"], ok: 0, ana: "Concesiva.", adv: "TIP: ObstÃ¡culo." },
            { s: "Dime quiÃ©n es.", q: "FunciÃ³n sub.", ops: ["CD", "Suj", "CI"], ok: 0, ana: "Sustantiva CD.", adv: "TIP: 'DÃ­melo'." },
            { s: "Es bueno leer.", q: "Sujeto.", ops: ["Bueno", "Leer", "No tiene"], ok: 1, ana: "Sub. infinitivo Suj.", adv: "TIP: 'ESO es bueno'." },
            { s: "Alegrarse de ir.", q: "FunciÃ³n sub.", ops: ["CRÃ©g", "CD", "Atr"], ok: 0, ana: "Sust. de CRÃ©g.", adv: "TIP: Alegrarse DE." },
            { s: "El que rÃ­e es Luis.", q: "FunciÃ³n 'QUE'.", ops: ["Suj", "CD", "Nexo"], ok: 0, ana: "Relativo Sujeto.", adv: "TIP: El chico rÃ­e." },
            { s: "Deseo que ganes.", q: "FunciÃ³n sub.", ops: ["CD", "Suj", "Atr"], ok: 0, ana: "Sustantiva CD.", adv: "TIP: 'Lo deseo'." },
            { s: "Vive donde puede.", q: "FunciÃ³n sub.", ops: ["CC Lug", "CD", "Suj"], ok: 0, ana: "Adverbial Lugar.", adv: "TIP: 'Vive ALLÃ'." },
            { s: "Hazlo segÃºn sabes.", q: "Tipo adverbial.", ops: ["Modo", "Tiem", "Caus"], ok: 0, ana: "Adverbial Modo.", adv: "TIP: 'ASÃ'." },
            { s: "Para ganar, corre.", q: "Tipo adverbial.", ops: ["Final", "Cons", "Caus"], ok: 0, ana: "Final.", adv: "TIP: PropÃ³sito." },
            { s: "En cuanto venga.", q: "Tipo adverbial.", ops: ["Tiem", "Lug", "Mod"], ok: 0, ana: "Tiempo.", adv: "TIP: Momento." },
            { s: "Por mÃ¡s que diga.", q: "Tipo subordinada.", ops: ["Conc", "Caus", "Cons"], ok: 0, ana: "Concesiva.", adv: "TIP: A pesar de." },
            { s: "Puesto que no va.", q: "Tipo subordinada.", ops: ["Caus", "Fin", "Cons"], ok: 0, ana: "Causal.", adv: "TIP: Motivo." },
            { s: "Tanto fue que cayÃ³.", q: "Tipo subordinada.", ops: ["Cons", "Caus", "Comp"], ok: 0, ana: "Consecutiva.", adv: "TIP: Grado." },
            { s: "Menos que ayer.", q: "Tipo subordinada.", ops: ["Comp", "Cons", "Modo"], ok: 0, ana: "Comparativa.", adv: "TIP: Inferioridad." },
            { s: "Antes de salir.", q: "Tipo adverbial.", ops: ["Tiem", "Lug", "Mod"], ok: 0, ana: "Tiempo.", adv: "TIP: Momento." },
            { s: "Quien calla, otorga.", q: "Sujeto.", ops: ["Quien calla", "Ã‰l", "No tiene"], ok: 0, ana: "Adj. Sust. Suj.", adv: "TIP: 'ESE otorga'." },
            { s: "Dime dÃ³nde estÃ¡s.", q: "FunciÃ³n sub.", ops: ["CD", "Suj", "CCL"], ok: 0, ana: "Sustantiva CD.", adv: "TIP: 'DÃ­melo'." },
            { s: "Ganas de comer.", q: "FunciÃ³n sub.", ops: ["CN", "CRÃ©g", "Suj"], ok: 0, ana: "Sust. de CN.", adv: "TIP: Ganas DE." },
            { s: "Harto de esperar.", q: "FunciÃ³n sub.", ops: ["CAdj", "CRÃ©g", "CD"], ok: 0, ana: "Sust. de CAdj.", adv: "TIP: Harto DE." },
            { s: "Cerca de ir.", q: "FunciÃ³n sub.", ops: ["CAdv", "CCL", "CD"], ok: 0, ana: "Sust. de CAdv.", adv: "TIP: Cerca DE." },
            { s: "Que mientas duele.", q: "FunciÃ³n sub.", ops: ["Suj", "CD", "Atr"], ok: 0, ana: "Sust. Sujeto.", adv: "TIP: 'ESO duele'." },
            { s: "Parece que miente.", q: "FunciÃ³n sub.", ops: ["Atr", "Suj", "CD"], ok: 0, ana: "Sust. Atributo.", adv: "TIP: 'LO parece'." },
            { s: "Mi plan es ir.", q: "FunciÃ³n sub.", ops: ["Atr", "CD", "Suj"], ok: 0, ana: "Sust. Atributo.", adv: "TIP: 'Mi plan LO es'." },
            { s: "Le gusta venir.", q: "FunciÃ³n sub.", ops: ["Suj", "CD", "CI"], ok: 0, ana: "Sust. Sujeto.", adv: "TIP: 'ESO le gusta'." },
            { s: "No sÃ© si ir.", q: "FunciÃ³n sub.", ops: ["CD", "Suj", "CCD"], ok: 0, ana: "Sustantiva CD.", adv: "TIP: 'No LO sÃ©'." },
            { s: "Dame lo que pidas.", q: "FunciÃ³n sub.", ops: ["CD", "CI", "Suj"], ok: 0, ana: "Adj. Sust. CD.", adv: "TIP: 'Dame ESO'." },
            { s: "Ayuda a quien va.", q: "FunciÃ³n sub.", ops: ["CD", "CI", "CCP"], ok: 0, ana: "Adj. Sust. CD.", adv: "TIP: 'AyÃºdalo'." },
            { s: "El que va, corre.", q: "FunciÃ³n sub.", ops: ["Suj", "CD", "Atr"], ok: 0, ana: "Adj. Sust. Suj.", adv: "TIP: 'ESE corre'." },
            { s: "La razÃ³n por que voy.", q: "Tipo subordinada.", ops: ["Adj", "Sust", "Caus"], ok: 0, ana: "Adjetiva.", adv: "TIP: 'La cual'." },
            { s: "Grita que asusta.", q: "Tipo subordinada.", ops: ["Cons", "Mod", "Cop"], ok: 0, ana: "Consecutiva.", adv: "TIP: Grado." },
            { s: "Como no vengas.", q: "Tipo subordinada.", ops: ["Cond", "Caus", "Mod"], ok: 0, ana: "Condicional.", adv: "TIP: 'SI NO'." },
            { s: "Viendo eso, se fue.", q: "Tipo subordinada.", ops: ["Caus", "Cond", "Tiem"], ok: 0, ana: "Causal.", adv: "TIP: Gerundio." },
            { s: "A fuerza de ir.", q: "Tipo subordinada.", ops: ["Caus", "Mod", "Fin"], ok: 0, ana: "Causal.", adv: "TIP: Causa." },
            { s: "Con ir, basta.", q: "Tipo subordinada.", ops: ["Conc", "Cond", "Mod"], ok: 0, ana: "Concesiva.", adv: "TIP: 'Aunque'." },
            { s: "Me voy, que es tarde.", q: "Tipo subordinada.", ops: ["Caus", "Cons", "Fin"], ok: 0, ana: "Causal.", adv: "TIP: 'Porque'." },
            { s: "Hicieron falta.", q: "Sujeto.", ops: ["Falta", "Ellos", "No tiene"], ok: 0, ana: "Falta (Sujeto).", adv: "TIP: 'Hicieron FALTAS'." },
            { s: "Parece listo.", q: "FunciÃ³n 'LISTO'.", ops: ["Atr", "CPred", "CCM"], ok: 0, ana: "Atributo.", adv: "TIP: 'LO parece'." },
            { s: "Llamaron a Luis.", q: "FunciÃ³n 'A LUIS'.", ops: ["CD", "CI", "Suj"], ok: 0, ana: "CD persona.", adv: "TIP: 'LO llamaron'." },
            { s: "ConfÃ­a en mÃ­.", q: "FunciÃ³n 'EN MÃ'.", ops: ["CRÃ©g", "CI", "CCM"], ok: 0, ana: "C. RÃ©gimen.", adv: "TIP: Confiar EN." },
            { s: "Dijo la verdad.", q: "FunciÃ³n 'LA VERDAD'.", ops: ["CD", "Suj", "Atr"], ok: 0, ana: "CD: 'LA dijo'.", adv: "TIP: Objeto directo." },
            { s: "Es para comer.", q: "FunciÃ³n 'PARA COMER'.", ops: ["Atr", "CCF", "CI"], ok: 0, ana: "Atributo.", adv: "TIP: 'LO es'." },
            { s: "Me molesta eso.", q: "Sujeto.", ops: ["Me", "Eso", "Yo"], ok: 1, ana: "Eso (Sujeto).", adv: "TIP: 'ESAS COSAS'." },
            { s: "Se dice que sÃ­.", q: "Tipo SE.", ops: ["Imp", "PR", "Ref"], ok: 0, ana: "Impersonal.", adv: "TIP: Sin sujeto." },
            { s: "Se venden casas.", q: "Tipo SE.", ops: ["PR", "Imp", "Rec"], ok: 0, ana: "Pasiva Refleja.", adv: "TIP: 'Son vendidas'." },
            { s: "Se lo dio ya.", q: "Tipo SE.", ops: ["Falso", "Ref", "Dat"], ok: 0, ana: "Sustituye LE.", adv: "TIP: LE + LO." },
            { s: "Se lava el pelo.", q: "Tipo SE.", ops: ["Ref CI", "Ref CD", "Dat"], ok: 0, ana: "Reflexivo CI.", adv: "TIP: CD es pelo." },
            { s: "Se miraron.", q: "Tipo SE.", ops: ["Rec", "Ref", "PR"], ok: 0, ana: "RecÃ­proco.", adv: "TIP: Mutuamente." },
            { s: "Se fue hoy.", q: "Tipo SE.", ops: ["Pron", "Imp", "Dat"], ok: 0, ana: "Pronominal.", adv: "TIP: Irse." },
            { s: "Se leyÃ³ el libro.", q: "Tipo SE.", ops: ["Dativo", "PR", "Ref"], ok: 0, ana: "Dativo Ã‰tico.", adv: "TIP: EnfÃ¡tico." },
            { s: "Se queja siempre.", q: "Tipo SE.", ops: ["Pron", "Imp", "Ref"], ok: 0, ana: "Pronominal.", adv: "TIP: Quejarse." },
            { s: "Se busca a Luis.", q: "Tipo SE.", ops: ["Imp", "PR", "Ref"], ok: 0, ana: "Impersonal.", adv: "TIP: Con 'a' persona." },
            { s: "Dijo que no.", q: "FunciÃ³n sub.", ops: ["CD", "Suj", "Atr"], ok: 0, ana: "Sustantiva CD.", adv: "TIP: 'DÃ­melo'." },
            { s: "Viene quien va.", q: "Sujeto.", ops: ["Quien va", "Ã‰l", "No tiene"], ok: 0, ana: "Adj. Sust. Suj.", adv: "TIP: 'ESE viene'." },
            { s: "LlegÃ³ cansado.", q: "FunciÃ³n 'CANSADO'.", ops: ["CPred", "CCM", "Atr"], ok: 0, ana: "Predicativo.", adv: "TIP: Concuerda." },
            { s: "Tan cerca de allÃ­.", q: "FunciÃ³n 'DE ALLÃ'.", ops: ["CAdv", "CCL", "CD"], ok: 0, ana: "Sust. de CAdv.", adv: "TIP: Cerca DE." },
            { s: "Deseo de ir.", q: "FunciÃ³n 'DE IR'.", ops: ["CN", "CRÃ©g", "CD"], ok: 0, ana: "Sust. de CN.", adv: "TIP: Deseo DE." },
            { s: "Harto de ti.", q: "FunciÃ³n 'DE TI'.", ops: ["CAdj", "CRÃ©g", "CI"], ok: 0, ana: "SPrep de CAdj.", adv: "TIP: Harto DE." },
            { s: "Dio flores a ella.", q: "FunciÃ³n 'A ELLA'.", ops: ["CI", "CD", "CCP"], ok: 0, ana: "CI: 'LE dio'.", adv: "TIP: Destinatario." },
            { s: "Trae pan hoy.", q: "FunciÃ³n 'PAN'.", ops: ["CD", "Suj", "CCT"], ok: 0, ana: "CD: 'LO trae'.", adv: "TIP: Directo." },
            { s: "Es el jefe.", q: "FunciÃ³n 'EL JEFE'.", ops: ["Atr", "CD", "CPred"], ok: 0, ana: "Atributo.", adv: "TIP: 'LO es'." },
            { s: "Viene pronto.", q: "FunciÃ³n 'PRONTO'.", ops: ["CCT", "CCM", "CCL"], ok: 0, ana: "CC Tiempo.", adv: "TIP: Â¿CuÃ¡ndo?" },
            { s: "Lo hizo bien.", q: "FunciÃ³n 'BIEN'.", ops: ["CCM", "CPred", "Atr"], ok: 0, ana: "CC Modo.", adv: "TIP: Â¿CÃ³mo?" },
            { s: "Mucho calor.", q: "FunciÃ³n 'MUCHO'.", ops: ["Cuant", "CCC", "CD"], ok: 0, ana: "Cuantificador.", adv: "TIP: Modifica sust." },
            { s: "Muy listo.", q: "FunciÃ³n 'MUY'.", ops: ["Cuant", "CCM", "CD"], ok: 0, ana: "Cuantificador.", adv: "TIP: Modifica adj." },
            { s: "Cerca de casa.", q: "FunciÃ³n 'DE CASA'.", ops: ["CAdv", "CCL", "CN"], ok: 0, ana: "C. de Adverbio.", adv: "TIP: Modifica adv." },
            { s: "Los excursionistas no dijeron dÃ³nde estar.", q: "Analiza 'DÃ“NDE ESTAR'.", ops: ["CD", "CCL", "Suj"], ok: 0, ana: "Sustantiva de CD.", adv: "TIP: 'No LO dijeron'." },
            { s: "Alumnos de Bachillerato presentaron el plan.", q: "FunciÃ³n 'DE BACHILLERATO'.", ops: ["CN", "CI", "CRÃ©g"], ok: 0, ana: "Complemento del Nombre.", adv: "TIP: Modifica a 'Alumnos'." },
            { s: "Cansado de que le repitieran lo mismo.", q: "FunciÃ³n sub.", ops: ["CAdj", "CRÃ©g", "CD"], ok: 0, ana: "Sustantiva de Adjetivo.", adv: "TIP: Modifica a 'Cansado'." },
            { s: "Hablamos con amigos pero no gustÃ³.", q: "RelaciÃ³n oracional.", ops: ["Adversativa", "Copulativa", "Disyuntiva"], ok: 0, ana: "Coordinada Adversativa.", adv: "TIP: Nexo PERO." },
            { s: "Me gusta hablar con amigos.", q: "FunciÃ³n de 'HABLAR'.", ops: ["Sujeto", "CD", "CCM"], ok: 0, ana: "Sub. infinitivo Sujeto.", adv: "TIP: 'ESO me gusta'." }
        ];

        class Boot extends Phaser.Scene {
            constructor() { super('Boot'); }
            create() {
                const gfx = this.make.graphics({x:0, y:0, add:false});
                gfx.fillStyle(0xffffff); gfx.fillRoundedRect(0,0,100,100,40);
                gfx.generateTexture('card', 100, 100);
                this.scene.start('Menu');
            }
        }

        class Menu extends Phaser.Scene {
            constructor() { super('Menu'); }
            create() {
                this.cameras.main.setBackgroundColor('#020617');
                const bgGfx = this.add.graphics();
                bgGfx.fillGradientStyle(0x0f172a, 0x0f172a, 0x020617, 0x020617, 1);
                bgGfx.fillRect(0, 0, this.scale.width, this.scale.height);

                this.add.text(this.scale.width/2, this.scale.height*0.3, "SINTAXIS MASTER", {
                    fontFamily: 'Outfit', fontSize: '110px', fontWeight: '900', color: '#fff'
                }).setOrigin(0.5).setShadow(0, 15, '#38bdf8', 30, true, true);

                this.createBtn(this.scale.width/2, this.scale.height*0.65, "COMENZAR RETO", 0x38bdf8, () => this.scene.start('Play'));
                
                this.add.text(this.scale.width/2, this.scale.height*0.88, "Legendary Edition: 150 Retos Aleatorios.", {
                    fontFamily: 'Outfit', fontSize: '24px', color: '#94a3b8', fontWeight: '400'
                }).setOrigin(0.5);
            }

            createBtn(x, y, txt, color, cb) {
                const c = this.add.container(x, y);
                const bg = this.add.nineslice(0, 0, 'card', 0, 600, 130, 40, 40, 40, 40).setTint(color);
                const t = this.add.text(0, 0, txt, { fontFamily: 'Outfit', fontSize: '42px', fontWeight: '900', color: '#020617' }).setOrigin(0.5);
                c.add([bg, t]);
                c.setSize(600, 130).setInteractive().on('pointerdown', () => {
                    this.tweens.add({ targets: c, scale: 0.92, duration: 100, yoyo: true, onComplete: cb });
                });
                return c;
            }
        }

        class Play extends Phaser.Scene {
            constructor() { super('Play'); }
            init() {
                this.score = 0; this.qIdx = 0; this.lives = 3; this.isPaused = false;
                this.qs = [...MASTER_DATABASE].sort(() => Math.random() - 0.5).slice(0, 10);
            }

            create() {
                this.cameras.main.setBackgroundColor('#020617');
                this.createUI();
                this.showQuestion();
            }

            createUI() {
                const headerBg = this.add.graphics();
                headerBg.fillStyle(0x0f172a, 0.85);
                headerBg.fillRoundedRect(40, 25, this.scale.width - 80, 90, 45);
                headerBg.lineStyle(2, 0x38bdf8, 0.3);
                headerBg.strokeRoundedRect(40, 25, this.scale.width - 80, 90, 45);

                this.sTxt = this.add.text(100, 70, `PTS: 0`, { fontFamily: 'Outfit', fontSize: '32px', fontWeight: '800', color: '#38bdf8' }).setOrigin(0, 0.5);
                this.lTxt = this.add.text(this.scale.width - 100, 70, `â¤â¤â¤`, { fontSize: '38px' }).setOrigin(1, 0.5);
                this.progressFill = this.add.graphics();
            }

            showQuestion() {
                if (this.qIdx >= 10) { this.scene.start('End', { s: this.score }); return; }
                const data = this.qs[this.qIdx];
                this.mainCont = this.add.container(this.scale.width/2, this.scale.height/2 - 20);

                const card = this.add.nineslice(0, 0, 'card', 0, 1150, 320, 50, 50, 50, 50).setTint(0x1e293b);
                const sentence = this.add.text(0, -60, `"${data.s}"`, { 
                    fontFamily: 'Outfit', fontSize: '42px', fontWeight: '700', color: '#38bdf8', align: 'center', wordWrap: { width: 1050 } 
                }).setOrigin(0.5);
                const question = this.add.text(0, 70, data.q, { 
                    fontFamily: 'Outfit', fontSize: '32px', color: '#f1f5f9', align: 'center', wordWrap: { width: 1050 } 
                }).setOrigin(0.5);

                this.mainCont.add([card, sentence, question]);

                data.ops.forEach((op, i) => {
                    const btn = this.createOptionBtn(-410 + (i * 410), 280, op, i === data.ok, data);
                    this.mainCont.add(btn);
                });

                this.updateProgress();
            }

            updateProgress() {
                this.progressFill.clear().fillStyle(0x38bdf8, 0.5).fillRoundedRect(this.scale.width/2 - 200, 100, 400, 6, 3);
                this.progressFill.fillStyle(0x38bdf8, 1).fillRoundedRect(this.scale.width/2 - 200, 100, 400 * (this.qIdx / 10), 6, 3);
            }

            createOptionBtn(x, y, txt, isOk, data) {
                const c = this.add.container(x, y);
                const bg = this.add.nineslice(0, 0, 'card', 0, 390, 150, 35, 35, 35, 35).setTint(0x334155);
                const t = this.add.text(0, 0, txt, { fontFamily: 'Outfit', fontSize: '26px', fontWeight: '600', color: '#fff', align: 'center', wordWrap: { width: 360 } }).setOrigin(0.5);
                c.add([bg, t]);
                c.setSize(390, 150).setInteractive().on('pointerdown', () => {
                    if (!this.isPaused) { this.isPaused = true; this.handleResult(isOk, bg, data); }
                });
                return c;
            }

            handleResult(win, bg, data) {
                bg.setTint(win ? 0x10b981 : 0xf43f5e);
                if (win) this.score += 100; else { this.lives--; this.lTxt.setText('â¤'.repeat(this.lives)); this.cameras.main.shake(250, 0.012); }
                this.sTxt.setText(`PTS: ${this.score}`);
                this.showFeedback(win, data);
            }

            showFeedback(win, data) {
                const overlay = this.add.graphics().fillStyle(0x020617, 0.9).fillRect(0, 0, this.scale.width, this.scale.height).setAlpha(0);
                this.tweens.add({ targets: overlay, alpha: 1, duration: 250 });

                const f = this.add.container(this.scale.width/2, this.scale.height/2);
                const fBg = this.add.nineslice(0, 0, 'card', 0, 1100, 600, 60, 60, 60, 60).setTint(0x0f172a);
                const fT = this.add.text(0, -200, win ? "ANÃLISIS CORRECTO" : "ERROR DETECTADO", { fontFamily: 'Outfit', fontSize: '64px', fontWeight: '900', color: win ? '#10b981' : '#f43f5e' }).setOrigin(0.5);
                const fD = this.add.text(0, -40, data.ana, { fontFamily: 'Outfit', fontSize: '30px', color: '#fff', align: 'center', wordWrap: { width: 1000 } }).setOrigin(0.5);
                const fA = this.add.text(0, 110, data.adv, { fontFamily: 'Outfit', fontSize: '26px', fontStyle: 'italic', color: '#38bdf8', align: 'center', wordWrap: { width: 1000 } }).setOrigin(0.5);
                
                const nextBtn = this.add.container(0, 240);
                const nBg = this.add.nineslice(0, 0, 'card', 0, 450, 100, 30, 30, 30, 30).setTint(0x38bdf8);
                const nT = this.add.text(0, 0, "CONTINUAR >", { fontFamily: 'Outfit', fontSize: '34px', fontWeight: '900', color: '#020617' }).setOrigin(0.5);
                nextBtn.add([nBg, nT]).setSize(450, 100).setInteractive().on('pointerdown', () => {
                    this.tweens.add({ targets: [this.mainCont, f, overlay], alpha: 0, duration: 200, onComplete: () => {
                        this.mainCont.destroy(); f.destroy(); overlay.destroy();
                        this.qIdx++; this.isPaused = false;
                        if (this.lives <= 0) this.scene.start('End', { s: this.score }); else this.showQuestion();
                    }});
                });

                f.add([fBg, fT, fD, fA, nextBtn]).setScale(0.85).setAlpha(0);
                this.tweens.add({ targets: f, alpha: 1, scale: 1, duration: 400, ease: 'Back.out' });
            }
        }

        class End extends Phaser.Scene {
            constructor() { super('End'); }
            create(d) {
                this.add.text(this.scale.width/2, this.scale.height*0.4, "RETO FINALIZADO", { fontFamily: 'Outfit', fontSize: '100px', fontWeight: '900', color: '#fff' }).setOrigin(0.5);
                this.add.text(this.scale.width/2, this.scale.height*0.55, `PTS TOTALES: ${d.s}`, { fontFamily: 'Outfit', fontSize: '60px', color: '#38bdf8', fontWeight: '800' }).setOrigin(0.5);
                const b = this.add.text(this.scale.width/2, this.scale.height*0.78, "REINTENTAR", { 
                    fontFamily: 'Outfit', fontSize: '42px', fontWeight: '900', color: '#020617', backgroundColor: '#38bdf8', padding: {x:70, y:35} 
                }).setOrigin(0.5).setInteractive().on('pointerdown', () => this.scene.start('Menu'));
            }
        }

        const config = {
            type: Phaser.AUTO, parent: 'game-container', width: 1280, height: 720,
            scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH },
            scene: [Boot, Menu, Play, End]
        };
        new Phaser.Game(config);
    </script>
</body>
</html>
